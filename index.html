<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ãƒ¢ãƒ³ãƒ†ã‚£ãƒ»ãƒ›ãƒ¼ãƒ«å•é¡Œï¼ˆã‚¹ãƒãƒ›å¯¾å¿œç‰ˆï¼‰</title>
    <style>
        :root {
            --door-color: #5d4037;
            --door-border: #3e2723;
            --bg-color: #f0f2f5;
            --accent-color: #3498db;
            --text-color: #333;
            --win-color: #2ecc71;
            --lose-color: #e74c3c;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px 10px;
        }

        h1 {
            margin: 0 0 10px 0;
            font-size: 1.5rem;
            text-align: center;
        }

        p.description {
            max-width: 600px;
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-size: 0.85rem;
            line-height: 1.4;
        }

        /* ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œï¼‰ */
        .game-container {
            display: flex;
            justify-content: center;
            gap: 10px; /* ã‚¹ãƒãƒ›å‘ã‘ã«éš™é–“ã‚’ç‹­ã */
            margin-bottom: 25px;
            perspective: 1000px;
            width: 100%;
            max-width: 500px; /* PCã§ã¯åºƒãŒã‚Šã™ããªã„ã‚ˆã†ã« */
        }

        .door-wrapper {
            position: relative;
            flex: 1; /* å‡ç­‰ã«å¹…ã‚’ã¨ã‚‹ */
            max-width: 110px; /* æœ€å¤§ã‚µã‚¤ã‚ºåˆ¶é™ */
            aspect-ratio: 2 / 3; /* ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã‚’ç¶­æŒ */
            cursor: pointer;
            /* ã‚¿ãƒƒãƒ—æ™‚ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’ç„¡åŠ¹åŒ–ï¼ˆã‚¹ãƒãƒ›ç”¨ï¼‰ */
            -webkit-tap-highlight-color: transparent;
        }

        /* ãƒ‰ã‚¢ã®å¾Œã‚ã®ä¸­èº« */
        .prize-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #ddd;
            border-radius: 6px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: clamp(2rem, 8vw, 3rem); /* ç”»é¢å¹…ã«å¿œã˜ã¦å¯å¤‰ */
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
            z-index: 1;
        }

        /* ãƒ‰ã‚¢æœ¬ä½“ */
        .door {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--door-color);
            border: 3px solid var(--door-border);
            border-radius: 6px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            z-index: 2;
            transform-origin: left;
            transition: transform 0.6s cubic-bezier(0.4, 2.08, 0.55, 0.44), box-shadow 0.3s;
            box-shadow: 0 3px 5px rgba(0,0,0,0.3);
            backface-visibility: hidden; 
        }

        .door::after {
            content: '';
            position: absolute;
            right: 8%;
            top: 50%;
            width: 12%;
            padding-bottom: 12%; /* æ­£å††ã‚’ä¿ã¤ */
            background-color: gold;
            border-radius: 50%;
            box-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        /* ãƒ‰ã‚¢ã®çŠ¶æ…‹ */
        .door.open {
            transform: rotateY(-110deg);
        }

        /* ã‚¹ãƒãƒ›ã§ã¯hoverã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒé‚ªé­”ã«ãªã‚‹ã“ã¨ãŒã‚ã‚‹ã®ã§ã€PCã®ã¿é©ç”¨ */
        @media (hover: hover) {
            .door-wrapper:hover .door:not(.open) {
                filter: brightness(1.1);
            }
        }

        .door-wrapper.selected .door {
            border-color: var(--accent-color);
            box-shadow: 0 0 10px var(--accent-color);
        }
        
        /* é¸æŠãƒãƒ¼ã‚¯ */
        .selection-indicator {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem;
            font-weight: bold;
            color: var(--accent-color);
            opacity: 0;
            transition: opacity 0.3s;
            white-space: nowrap;
        }
        .door-wrapper.selected .selection-indicator {
            opacity: 1;
        }

        /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        .status-message {
            font-size: 1rem;
            font-weight: bold;
            min-height: 3em; /* 2è¡Œã«ãªã£ã¦ã‚‚ã‚¬ã‚¿ã¤ã‹ãªã„é«˜ã•ç¢ºä¿ */
            margin-bottom: 15px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .controls {
            display: flex;
            flex-direction: column; /* ã‚¹ãƒãƒ›ã§ã¯ç¸¦ä¸¦ã³ã®æ–¹ãŒæŠ¼ã—ã‚„ã™ã„å ´åˆã‚‚è€ƒæ…® */
            gap: 10px;
            margin-bottom: 25px;
            width: 100%;
            max-width: 300px;
        }

        button {
            padding: 12px 20px;
            font-size: 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background-color: var(--accent-color);
            color: white;
            transition: background 0.2s, transform 0.1s;
            width: 100%;
            font-weight: bold;
            touch-action: manipulation; /* ã‚¿ãƒƒãƒ—ã®é…å»¶ã‚’é˜²æ­¢ */
        }
        
        button:active {
            transform: scale(0.98);
        }
        
        button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
            display: none; /* ç„¡åŠ¹æ™‚ã¯éè¡¨ç¤ºã«ã—ã¦ã‚¹ãƒšãƒ¼ã‚¹ã‚’è©°ã‚ã‚‹ */
        }

        button.reset-btn {
            background-color: #34495e;
            display: block !important; /* ãƒªã‚»ãƒƒãƒˆã¯å¸¸ã«è¡¨ç¤º */
        }

        /* çµ±è¨ˆã‚¨ãƒªã‚¢ */
        .stats-container {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            width: 100%;
            max-width: 500px;
        }

        .stats-title {
            text-align: center;
            margin: 0 0 10px 0;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
            font-size: 1rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .stat-box {
            text-align: center;
            padding: 5px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #7f8c8d;
            margin-bottom: 2px;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
            line-height: 1.2;
        }

        .win-rate {
            font-size: 0.85rem;
            color: var(--win-color);
            margin-top: 2px;
        }
    </style>
</head>
<body>

    <h1>ãƒ¢ãƒ³ãƒ†ã‚£ãƒ»ãƒ›ãƒ¼ãƒ«å•é¡Œ</h1>
    <p class="description">
        1. ãƒ‰ã‚¢ã‚’ã‚¿ãƒƒãƒ—ã—ã¦é¸æŠ<br>
        2. ãƒã‚ºãƒ¬ã®ãƒ‰ã‚¢ãŒé–‹ã<br>
        3. ã€Œå¤‰ãˆã‚‹ã€ã‹ã€Œãã®ã¾ã¾ã€ã‹æ±ºæ–­ï¼
    </p>

    <div class="status-message" id="message">ãƒ‰ã‚¢ã‚’1ã¤é¸ã‚“ã§ãã ã•ã„</div>

    <div class="game-container">
        <div class="door-wrapper" id="door-0" onclick="handleDoorClick(0)">
            <div class="prize-container" id="prize-0">ğŸ</div>
            <div class="door" id="door-face-0">1</div>
            <div class="selection-indicator">é¸æŠä¸­</div>
        </div>
        <div class="door-wrapper" id="door-1" onclick="handleDoorClick(1)">
            <div class="prize-container" id="prize-1">ğŸ</div>
            <div class="door" id="door-face-1">2</div>
            <div class="selection-indicator">é¸æŠä¸­</div>
        </div>
        <div class="door-wrapper" id="door-2" onclick="handleDoorClick(2)">
            <div class="prize-container" id="prize-2">ğŸ</div>
            <div class="door" id="door-face-2">3</div>
            <div class="selection-indicator">é¸æŠä¸­</div>
        </div>
    </div>

    <div class="controls">
        <button id="action-btn" onclick="confirmChoice()" disabled>æ±ºå®š / å¤‰æ›´</button>
        <button class="reset-btn" onclick="initGame()">ãƒªã‚»ãƒƒãƒˆã—ã¦æ¬¡ã¸</button>
    </div>

    <div class="stats-container">
        <h3 class="stats-title">ã“ã“ã¾ã§ã®æˆç¸¾</h3>
        <div class="stats-grid">
            <div class="stat-box">
                <div class="stat-label">å¤‰ãˆãŸå ´åˆ</div>
                <div class="stat-value"><span id="switch-win">0</span> / <span id="switch-total">0</span></div>
                <div class="win-rate" id="switch-rate">å‹ç‡: 0%</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">å¤‰ãˆãªã„å ´åˆ</div>
                <div class="stat-value"><span id="stay-win">0</span> / <span id="stay-total">0</span></div>
                <div class="win-rate" id="stay-rate">å‹ç‡: 0%</div>
            </div>
        </div>
    </div>

<script>
    // --- ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹ç®¡ç†å¤‰æ•° ---
    const STATE = {
        PICK: 'pick',       // æœ€åˆã®é¸æŠå¾…ã¡
        REVEAL: 'reveal',   // ãƒ¢ãƒ³ãƒ†ã‚£ãŒãƒ‰ã‚¢ã‚’é–‹ã‘ã‚‹
        DECIDE: 'decide',   // å¤‰ãˆã‚‹ã‹å¤‰ãˆãªã„ã‹é¸æŠå¾…ã¡
        RESULT: 'result'    // çµæœç™ºè¡¨æ¸ˆã¿
    };

    let currentState = STATE.PICK;
    let prizeDoorIndex = -1;
    let selectedDoorIndex = -1;
    let openedDoorIndex = -1;
    let initialPickIndex = -1; // æœ€åˆã«é¸ã‚“ã ãƒ‰ã‚¢ï¼ˆçµ±è¨ˆç”¨ï¼‰
    
    let stats = {
        switch: { wins: 0, total: 0 },
        stay: { wins: 0, total: 0 }
    };

    const messageEl = document.getElementById('message');
    const actionBtn = document.getElementById('action-btn');

    function initGame() {
        currentState = STATE.PICK;
        selectedDoorIndex = -1;
        openedDoorIndex = -1;
        initialPickIndex = -1;
        
        // å½“ãŸã‚Šã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«æ±ºå®š
        prizeDoorIndex = Math.floor(Math.random() * 3);

        for (let i = 0; i < 3; i++) {
            const doorWrapper = document.getElementById(`door-${i}`);
            const doorFace = document.getElementById(`door-face-${i}`);
            const prizeContent = document.getElementById(`prize-${i}`);
            
            doorWrapper.classList.remove('selected');
            doorFace.classList.remove('open');
            doorWrapper.style.cursor = 'pointer';
            
            prizeContent.textContent = (i === prizeDoorIndex) ? 'ğŸš—' : 'ğŸ';
        }

        messageEl.textContent = "ãƒ‰ã‚¢ã‚’1ã¤é¸ã‚“ã§ãã ã•ã„";
        messageEl.style.color = "#333";
        
        actionBtn.textContent = "æ±ºå®š / å¤‰æ›´";
        actionBtn.disabled = true;
    }

    function handleDoorClick(doorIndex) {
        if (currentState === STATE.RESULT) return;
        if (doorIndex === openedDoorIndex) return;

        if (currentState === STATE.PICK) {
            initialPickIndex = doorIndex; // çµ±è¨ˆç”¨ã«ä¿å­˜
            selectDoor(doorIndex);
            
            messageEl.textContent = "ãƒ¢ãƒ³ãƒ†ã‚£ãŒãƒã‚ºãƒ¬ã®ãƒ‰ã‚¢ã‚’é–‹ã‘ã¾ã™...";
            
            // å°‘ã—å¾…ã£ã¦ã‹ã‚‰ãƒ¢ãƒ³ãƒ†ã‚£ãŒé–‹ã‘ã‚‹ï¼ˆæ¼”å‡ºï¼‰
            setTimeout(montyOpensDoor, 800); 

        } else if (currentState === STATE.DECIDE) {
            selectDoor(doorIndex);
            
            // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ›´æ–°
            if (doorIndex === initialPickIndex) {
                 messageEl.textContent = "ã€Œå¤‰ãˆãªã„ã€ã§æ±ºå®šã—ã¾ã™ã‹ï¼Ÿ";
                 actionBtn.textContent = "å¤‰ãˆãªã„ã§æ±ºå®š";
            } else {
                 messageEl.textContent = "ã€Œå¤‰ãˆã‚‹ã€ã§æ±ºå®šã—ã¾ã™ã‹ï¼Ÿ";
                 actionBtn.textContent = "å¤‰ãˆã¦æ±ºå®š";
            }
            
            actionBtn.disabled = false;
        }
    }

    function selectDoor(index) {
        selectedDoorIndex = index;
        for (let i = 0; i < 3; i++) {
            const el = document.getElementById(`door-${i}`);
            if (i === index) {
                el.classList.add('selected');
            } else {
                el.classList.remove('selected');
            }
        }
    }

    function montyOpensDoor() {
        // å½“ãŸã‚Šã§ã¯ãªãã€ã‹ã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸ã‚“ã§ã„ãªã„ãƒ‰ã‚¢ã‚’æ¢ã™
        const availableDoors = [0, 1, 2].filter(
            i => i !== prizeDoorIndex && i !== selectedDoorIndex
        );
        
        openedDoorIndex = availableDoors[Math.floor(Math.random() * availableDoors.length)];
        document.getElementById(`door-face-${openedDoorIndex}`).classList.add('open');

        currentState = STATE.DECIDE;
        messageEl.textContent = `æ®‹ã‚Šã®ãƒ‰ã‚¢ã‚’é¸ã³ç›´ã›ã¾ã™ã€‚\nã©ã†ã—ã¾ã™ã‹ï¼Ÿ`;
        
        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒœã‚¿ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
        actionBtn.textContent = "ã“ã®ã¾ã¾æ±ºå®š";
        actionBtn.disabled = false; // ãã®ã¾ã¾ã§ã‚‚æ±ºå®šã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
    }

    function confirmChoice() {
        if (currentState !== STATE.DECIDE) return;

        currentState = STATE.RESULT;
        actionBtn.disabled = true;

        // å…¨ã¦ã®ãƒ‰ã‚¢ã‚’é–‹ã‘ã‚‹
        for (let i = 0; i < 3; i++) {
            document.getElementById(`door-face-${i}`).classList.add('open');
        }

        const isWin = (selectedDoorIndex === prizeDoorIndex);
        checkResult(isWin);
    }

    function checkResult(isWin) {
        const didSwitch = (initialPickIndex !== selectedDoorIndex);
        
        if (isWin) {
            messageEl.textContent = "ãŠã‚ã§ã¨ã†ï¼å½“ãŸã‚Šã§ã™ï¼ğŸš—";
            messageEl.style.color = "var(--win-color)";
        } else {
            messageEl.textContent = "æ®‹å¿µï¼ãƒã‚ºãƒ¬ã§ã™...ğŸ";
            messageEl.style.color = "var(--lose-color)";
        }

        if (didSwitch) {
            stats.switch.total++;
            if (isWin) stats.switch.wins++;
        } else {
            stats.stay.total++;
            if (isWin) stats.stay.wins++;
        }
        updateStatsUI();
    }

    function updateStatsUI() {
        // å¤‰ãˆãŸå ´åˆ
        document.getElementById('switch-win').textContent = stats.switch.wins;
        document.getElementById('switch-total').textContent = stats.switch.total;
        const switchRate = stats.switch.total === 0 ? 0 : Math.round((stats.switch.wins / stats.switch.total) * 100);
        document.getElementById('switch-rate').textContent = `å‹ç‡: ${switchRate}%`;

        // å¤‰ãˆãªã‹ã£ãŸå ´åˆ
        document.getElementById('stay-win').textContent = stats.stay.wins;
        document.getElementById('stay-total').textContent = stats.stay.total;
        const stayRate = stats.stay.total === 0 ? 0 : Math.round((stats.stay.wins / stats.stay.total) * 100);
        document.getElementById('stay-rate').textContent = `å‹ç‡: ${stayRate}%`;
    }

    // åˆæœŸåŒ–å®Ÿè¡Œ
    initGame();

</script>
</body>
</html>
